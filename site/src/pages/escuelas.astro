---
import BaseLayout from '../layouts/BaseLayout.astro';
import schoolsData from '../data/schools.json';

// Separar el ITO (sede) del resto de las escuelas clasificadas
const sedeSchool = schoolsData.find(school => school.sede === true);
const classifiedSchools = schoolsData.filter(school => school.sede !== true);
const totalSchools = schoolsData.length; // 41 total (40 clasificadas + 1 sede)
const regions = [...new Set(schoolsData.map(school => school.region))].sort();
---

<BaseLayout 
  title="Escuelas | XXXI Encuentro Escoltas y Bandas 2026"
  description="Conoce los 40 Institutos Tecnológicos clasificados más el Instituto Tecnológico de Oaxaca como sede en el XXXI Encuentro Nacional de Escoltas y Bandas de Guerra del TecNM 2026."
>
  <!-- Hero Section -->
  <section class="page-hero">
    <div class="container">
      <div class="page-hero-content">
        <span class="page-badge">40 Instituciones Clasificadas + Sede Oaxaca</span>
        <h1 class="page-title">Tecnológicos Participantes</h1>
        <p class="page-subtitle">
          Institutos Tecnológicos que representarán al TecNM en el encuentro nacional
        </p>
      </div>
    </div>
  </section>

  <!-- Search and Filter Section -->
  <section class="search-section section-alt">
    <div class="container">
      <div class="search-bar-wrapper">
        <div class="search-bar">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input 
            type="text" 
            id="searchInput" 
            placeholder="Buscar por nombre de instituto..." 
            class="search-input"
          />
          <button id="clearSearch" class="clear-search" style="display: none;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <div class="filter-buttons">
          <button class="filter-btn active" data-region="all">
            Todas las Regiones
          </button>
          {regions.map(region => (
            <button class="filter-btn" data-region={region}>
              {region}
            </button>
          ))}
        </div>
      </div>

    </div>
  </section>

  <!-- Schools Grid -->
  <section class="schools-section">
    <div class="container">
      <div class="schools-grid" id="schoolsGrid">
        <!-- Instituto Tecnológico de Oaxaca - Sede -->
        {sedeSchool && (
          <div class="school-card school-card-sede card" data-region={sedeSchool.region} data-name={sedeSchool.name.toLowerCase()}>
            <div class="school-header">
              <div class="school-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                  <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
                </svg>
              </div>
              <span class="school-region-badge badge badge-primary">{sedeSchool.region}</span>
            </div>
            
            <div class="school-body">
              <h3 class="school-name">{sedeSchool.name}</h3>
              <p class="school-description">{sedeSchool.description}</p>
            </div>

            <div class="school-footer">
              <div class="school-disciplines">
                <span class="discipline-tag discipline-tag-sede">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                  </svg>
                  Escolta
                </span>
                <span class="discipline-tag discipline-tag-sede">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 18V5l12-2v13"></path>
                    <circle cx="6" cy="18" r="3"></circle>
                    <circle cx="18" cy="16" r="3"></circle>
                  </svg>
                  Banda
                </span>
                <span class="discipline-tag discipline-tag-sede-badge">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                  Sede
                </span>
              </div>
              {sedeSchool.website && (
                <a href={sedeSchool.website} target="_blank" rel="noopener" class="school-link">
                  Sitio web
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                  </svg>
                </a>
              )}
            </div>
          </div>
        )}

        {classifiedSchools.map((school) => (
          <div class="school-card card" data-region={school.region} data-name={school.name.toLowerCase()}>
            <div class="school-header">
              <div class="school-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                  <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
                </svg>
              </div>
              <span class="school-region-badge badge badge-primary">{school.region}</span>
            </div>
            
            <div class="school-body">
              <h3 class="school-name">{school.name}</h3>
              <p class="school-description">{school.description}</p>
            </div>

            <div class="school-footer">
              <div class="school-disciplines">
                <span class="discipline-tag">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                  </svg>
                  Escolta
                </span>
                <span class="discipline-tag">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 18V5l12-2v13"></path>
                    <circle cx="6" cy="18" r="3"></circle>
                    <circle cx="18" cy="16" r="3"></circle>
                  </svg>
                  Banda
                </span>
              </div>
              {school.website && (
                <a href={school.website} target="_blank" rel="noopener" class="school-link">
                  Sitio web
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                  </svg>
                </a>
              )}
            </div>
          </div>
        ))}
      </div>

      <div id="noResults" class="no-results" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <h3>No se encontraron resultados</h3>
        <p>Intenta con otro término de búsqueda o selecciona una región diferente</p>
      </div>
    </div>
  </section>

  <!-- Statistics Section -->
  <section class="stats-section section-primary">
    <div class="container">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number">41</div>
          <div class="stat-label">Instituciones Participantes</div>
          <div class="stat-sublabel">(40 Clasificadas + Sede Oaxaca)</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">3</div>
          <div class="stat-label">Regiones Representadas</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">82</div>
          <div class="stat-label">Grupos Competidores</div>
          <div class="stat-sublabel">(41 Escoltas + 41 Bandas)</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">1000+</div>
          <div class="stat-label">Estudiantes Participantes</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Regional Info -->
  <section class="regional-info-section">
    <div class="container">
      <div class="section-header text-center">
        <h2>Clasificación Regional</h2>
        <p class="lead">
          Los institutos clasificaron a través de encuentros regionales realizados en 2026
        </p>
      </div>

      <div class="grid grid-3">
        <div class="regional-card card">
          <div class="regional-header">
            <div class="regional-icon regional-icon-norte">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                <polyline points="2 17 12 22 22 17"></polyline>
                <polyline points="2 12 12 17 22 12"></polyline>
              </svg>
            </div>
            <h3>Región Norte</h3>
          </div>
          <div class="regional-body">
            <div class="regional-stat">
              <strong>{schoolsData.filter(s => s.region === 'Norte').length}</strong>
              <span>instituciones</span>
            </div>
            <p class="regional-description">
              <strong>Sede Regional:</strong> Instituto Tecnológico de Saltillo
            </p>
            <p class="text-muted">
              Estados: Baja California, Chihuahua, Coahuila, Durango, Nayarit, Nuevo León, Sinaloa, Sonora, Tamaulipas
            </p>
          </div>
        </div>

        <div class="regional-card card">
          <div class="regional-header">
            <div class="regional-icon regional-icon-centro">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                <polyline points="2 17 12 22 22 17"></polyline>
                <polyline points="2 12 12 17 22 12"></polyline>
              </svg>
            </div>
            <h3>Región Centro</h3>
          </div>
          <div class="regional-body">
            <div class="regional-stat">
              <strong>{schoolsData.filter(s => s.region === 'Centro').length}</strong>
              <span>instituciones</span>
            </div>
            <p class="regional-description">
              <strong>Sede Regional:</strong> Instituto Tecnológico de Celaya
            </p>
            <p class="text-muted">
              Estados: Aguascalientes, Guanajuato, Jalisco, México, Michoacán, Morelos, Puebla, Querétaro, San Luis Potosí, Tlaxcala, Zacatecas
            </p>
          </div>
        </div>

        <div class="regional-card card">
          <div class="regional-header">
            <div class="regional-icon regional-icon-sur">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                <polyline points="2 17 12 22 22 17"></polyline>
                <polyline points="2 12 12 17 22 12"></polyline>
              </svg>
            </div>
            <h3>Región Sur</h3>
          </div>
          <div class="regional-body">
            <div class="regional-stat">
              <strong>{schoolsData.filter(s => s.region === 'Sur').length}</strong>
              <span>instituciones</span>
            </div>
            <p class="regional-description">
              <strong>Sede Regional:</strong> Instituto Tecnológico de Orizaba
            </p>
            <p class="text-muted">
              Estados: Campeche, Chiapas, Guerrero, Hidalgo, Oaxaca, Quintana Roo, Tabasco, Veracruz, Yucatán
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* Hero */
  .page-hero {
    background: linear-gradient(135deg, rgba(27, 57, 106, 0.5) 0%, rgba(93, 133, 166, 0.5) 100%), url('/images/oaxaca/1_6211406-GettyImages-174634635-scaled.jpg');
    background-size: cover;
    background-position: center;
    padding: 4rem 0 3rem;
    color: white;
    position: relative;
  }

  .page-hero-content {
    position: relative;
    text-align: center;
    max-width: 800px;
    margin: 0 auto;
  }

  .page-badge {
    display: inline-block;
    padding: 0.5rem 1.5rem;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-full);
    font-weight: 600;
    font-size: 0.9375rem;
    margin-bottom: var(--spacing-md);
    border: 1px solid rgba(255, 255, 255, 0.3);
  }

  .page-title {
    color: white;
    margin-bottom: var(--spacing-sm);
  }

  .page-subtitle {
    font-size: 1.25rem;
    color: rgba(255, 255, 255, 0.9);
    font-weight: 300;
  }

  /* Search Section */
  .search-section {
    padding: var(--spacing-xl) 0;
  }

  .search-bar-wrapper {
    max-width: 900px;
    margin: 0 auto;
  }

  .search-bar {
    position: relative;
    margin-bottom: var(--spacing-md);
    background: white;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    display: flex;
    align-items: center;
    padding: 0 1.5rem;
    gap: 1rem;
    border: 2px solid transparent;
    transition: all var(--transition-base);
  }

  .search-bar:focus-within {
    border-color: var(--color-primary);
    box-shadow: var(--shadow-xl), 0 0 0 4px rgba(139, 21, 56, 0.1);
  }

  .search-icon {
    flex-shrink: 0;
    stroke: var(--color-text-lighter);
  }

  .search-input {
    flex: 1;
    border: none;
    padding: 1.25rem 0;
    font-size: 1.125rem;
    font-family: var(--font-primary);
    outline: none;
  }

  .search-input::placeholder {
    color: var(--color-text-lighter);
  }

  .clear-search {
    flex-shrink: 0;
    background: var(--color-bg-alt);
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .clear-search:hover {
    background: var(--color-primary);
  }

  .clear-search:hover svg {
    stroke: white;
  }

  .filter-buttons {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .filter-btn {
    padding: 0.625rem 1.25rem;
    background: white;
    border: 2px solid var(--color-border);
    border-radius: var(--radius-full);
    font-weight: 600;
    font-size: 0.9375rem;
    cursor: pointer;
    transition: all var(--transition-base);
    color: var(--color-text);
  }

  .filter-btn:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
    transform: translateY(-2px);
  }

  .filter-btn.active {
    background: linear-gradient(135deg, var(--color-tecnm-primary) 0%, #152d52 100%);
    color: white;
    border-color: var(--color-primary);
  }

  .search-results-info {
    text-align: center;
    margin-top: var(--spacing-md);
    padding: var(--spacing-sm);
  }

  .search-results-info p {
    color: var(--color-text-light);
    margin: 0;
    font-size: 1rem;
  }

  /* Schools Grid */
  .schools-section {
    padding: var(--spacing-2xl) 0;
  }

  .schools-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: var(--spacing-md);
  }

  .school-card {
    display: flex;
    flex-direction: column;
    transition: all var(--transition-base);
  }

  .school-card.hidden {
    display: none;
  }

  .school-card-sede {
    background: linear-gradient(135deg, rgba(139, 21, 56, 0.04) 0%, rgba(27, 57, 106, 0.06) 100%);
    border: 1px solid rgba(139, 21, 56, 0.2);
    box-shadow: 0 2px 12px rgba(139, 21, 56, 0.08);
    position: relative;
    overflow: hidden;
  }

  .school-card-sede::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, rgba(139, 21, 56, 0.3) 0%, rgba(27, 57, 106, 0.4) 50%, rgba(139, 21, 56, 0.3) 100%);
  }

  .school-card-sede .school-icon {
    background: linear-gradient(135deg, rgba(139, 21, 56, 0.08) 0%, rgba(27, 57, 106, 0.06) 100%);
  }

  .school-card-sede .school-icon svg {
    stroke: var(--color-primary);
  }

  .school-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--spacing-md);
  }

  .school-icon {
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, rgba(27, 57, 106, 0.1) 0%, rgba(27, 57, 106, 0.05) 100%);
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .school-icon svg {
    stroke: var(--color-primary);
  }

  .school-region-badge {
    font-size: 0.8125rem;
  }

  .school-body {
    flex: 1;
    margin-bottom: var(--spacing-md);
  }

  .school-name {
    font-size: 1.25rem;
    margin-bottom: 0.75rem;
    line-height: 1.4;
  }

  .school-description {
    font-size: 0.9375rem;
    margin: 0;
    color: var(--color-text-light);
    line-height: 1.6;
  }

  .school-footer {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-sm);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
  }

  .school-disciplines {
    display: flex;
    gap: 0.5rem;
  }

  .discipline-tag {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.625rem;
    background: var(--color-bg-alt);
    border-radius: var(--radius-sm);
    font-size: 0.8125rem;
    color: var(--color-text-light);
    font-weight: 500;
  }

  .discipline-tag svg {
    flex-shrink: 0;
    stroke: var(--color-secondary);
  }

  .discipline-tag-sede {
    background: rgba(139, 21, 56, 0.08);
  }

  .discipline-tag-sede svg {
    stroke: var(--color-primary);
  }

  .discipline-tag-sede-badge {
    background: linear-gradient(135deg, rgba(139, 21, 56, 0.12) 0%, rgba(27, 57, 106, 0.1) 100%);
    color: var(--color-primary);
    font-weight: 600;
    border: 1px solid rgba(139, 21, 56, 0.25);
  }

  .discipline-tag-sede-badge svg {
    stroke: var(--color-primary);
  }

  .school-link {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    color: var(--color-accent);
    font-weight: 600;
    font-size: 0.9375rem;
    transition: all var(--transition-fast);
  }

  .school-link:hover {
    color: var(--color-primary);
    gap: 0.625rem;
  }

  .school-link svg {
    flex-shrink: 0;
  }

  /* No Results */
  .no-results {
    text-align: center;
    padding: var(--spacing-2xl) var(--spacing-md);
  }

  .no-results svg {
    stroke: var(--color-text-lighter);
    margin: 0 auto var(--spacing-md);
  }

  .no-results h3 {
    color: var(--color-text);
    margin-bottom: var(--spacing-sm);
  }

  .no-results p {
    color: var(--color-text-lighter);
    max-width: 400px;
    margin: 0 auto;
  }

  /* Stats Section */
  .stats-section {
    padding: var(--spacing-2xl) 0;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-lg);
  }

  .stat-card {
    text-align: center;
    color: white;
  }

  .stat-number {
    font-size: clamp(2.5rem, 5vw, 4rem);
    font-weight: 800;
    line-height: 1;
    margin-bottom: 0.5rem;
    color: var(--color-secondary);
  }

  .stat-label {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }

  .stat-sublabel {
    font-size: 0.875rem;
    color: rgba(255, 255, 255, 0.8);
  }

  /* Regional Info */
  .regional-info-section {
    padding: var(--spacing-2xl) 0;
  }

  .regional-card {
    padding: var(--spacing-lg);
  }

  .regional-header {
    text-align: center;
    margin-bottom: var(--spacing-md);
  }

  .regional-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto var(--spacing-md);
    border-radius: var(--radius-xl);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .regional-icon-norte {
    background: linear-gradient(135deg, rgba(93, 133, 166, 0.1) 0%, rgba(93, 133, 166, 0.05) 100%);
  }

  .regional-icon-norte svg {
    stroke: var(--color-accent);
  }

  .regional-icon-centro {
    background: linear-gradient(135deg, rgba(27, 57, 106, 0.1) 0%, rgba(27, 57, 106, 0.05) 100%);
  }

  .regional-icon-centro svg {
    stroke: var(--color-primary);
  }

  .regional-icon-sur {
    background: linear-gradient(135deg, rgba(197, 165, 114, 0.2) 0%, rgba(197, 165, 114, 0.1) 100%);
  }

  .regional-icon-sur svg {
    stroke: #8B7355;
  }

  .regional-header h3 {
    font-size: 1.5rem;
    margin: 0;
  }

  .regional-body {
    text-align: center;
  }

  .regional-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    margin-bottom: var(--spacing-md);
    padding: var(--spacing-sm);
    background: var(--color-bg-alt);
    border-radius: var(--radius-md);
  }

  .regional-stat strong {
    font-size: 2.5rem;
    color: var(--color-primary);
    line-height: 1;
  }

  .regional-stat span {
    font-size: 1rem;
    color: var(--color-text-light);
    font-weight: 500;
  }

  .regional-description {
    margin-bottom: var(--spacing-sm);
    text-align: left;
  }

  .regional-description strong {
    color: var(--color-primary);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .schools-grid {
      grid-template-columns: 1fr;
    }

    .filter-buttons {
      flex-direction: column;
    }

    .filter-btn {
      width: 100%;
    }

    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 480px) {
    .stats-grid {
      grid-template-columns: 1fr;
    }

    .school-footer {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>

<script>
  // Search and filter functionality
  const searchInput = document.getElementById('searchInput') as HTMLInputElement;
  const clearSearchBtn = document.getElementById('clearSearch') as HTMLButtonElement;
  const filterButtons = document.querySelectorAll('.filter-btn');
  const schoolCards = document.querySelectorAll('.school-card');
  const resultsCount = document.getElementById('resultsCount');
  const noResults = document.getElementById('noResults');
  const schoolsGrid = document.getElementById('schoolsGrid');

  let currentRegion = 'all';
  let currentSearch = '';

  function filterSchools() {
    let visibleCount = 0;

    schoolCards.forEach((card) => {
      const cardElement = card as HTMLElement;
      const region = cardElement.dataset.region || '';
      const name = cardElement.dataset.name || '';

      const matchesRegion = currentRegion === 'all' || region === currentRegion;
      const matchesSearch = name.includes(currentSearch.toLowerCase());

      if (matchesRegion && matchesSearch) {
        cardElement.classList.remove('hidden');
        cardElement.style.display = '';
        visibleCount++;
      } else {
        cardElement.classList.add('hidden');
        cardElement.style.display = 'none';
      }
    });

    // Update results count
    if (resultsCount) {
      resultsCount.innerHTML = `Mostrando <strong>${visibleCount}</strong> ${visibleCount === 1 ? 'institución' : 'instituciones'}`;
    }

    // Show/hide no results message
    if (noResults && schoolsGrid) {
      if (visibleCount === 0) {
        noResults.style.display = 'block';
        schoolsGrid.style.display = 'none';
      } else {
        noResults.style.display = 'none';
        schoolsGrid.style.display = 'grid';
      }
    }
  }

  // Search input handler
  if (searchInput) {
    searchInput.addEventListener('input', (e) => {
      const target = e.target as HTMLInputElement;
      currentSearch = target.value;
      filterSchools();

      // Show/hide clear button
      if (clearSearchBtn) {
        clearSearchBtn.style.display = currentSearch ? 'flex' : 'none';
      }
    });
  }

  // Clear search button
  if (clearSearchBtn && searchInput) {
    clearSearchBtn.addEventListener('click', () => {
      searchInput.value = '';
      currentSearch = '';
      clearSearchBtn.style.display = 'none';
      filterSchools();
      searchInput.focus();
    });
  }

  // Filter buttons
  filterButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      filterButtons.forEach((b) => b.classList.remove('active'));
      btn.classList.add('active');

      const btnElement = btn as HTMLElement;
      currentRegion = btnElement.dataset.region || 'all';
      filterSchools();
    });
  });
</script>
