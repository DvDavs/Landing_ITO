---
import BaseLayout from '../layouts/BaseLayout.astro';
import Icon from '../components/Icon.astro';

const locations = [
  {
    id: 'direccion',
    name: 'Dirección',
    icon: 'mdi:office-building',
    images: {
      mapa: '/images/direccion/mapa.png',
      satelital: '/images/direccion/satelital.png'
    },
    routeUrl: 'https://maps.app.goo.gl/aCLau7wuqve9dmFN8'
  },
  {
    id: 'gimnasio',
    name: 'Gimnasio Auditorio',
    icon: 'mdi:dumbbell',
    images: {
      mapa: '/images/gym/mapa.png',
      satelital: '/images/gym/satelital.png'
    },
    routeUrl: 'https://maps.app.goo.gl/cvJitdrjZtEog2XEA'
  },
  {
    id: 'centro-informacion',
    name: 'Centro de Información',
    icon: 'mdi:information-outline',
    images: {
      mapa: '/images/ci/mapa.png',
      satelital: '/images/ci/satelital.png'
    },
    routeUrl: 'https://maps.app.goo.gl/6nH8WMVNipxKa3ZA6'
  },
  {
    id: 'estadio',
    name: 'Estadio',
    icon: 'mdi:stadium',
    images: {
      mapa: '/images/Estadio/mapa.png',
      satelital: '/images/Estadio/satelital.png'
    },
    routeUrl: 'https://www.google.com/maps/dir//Estadio+Tecnol%C3%B3gico+de+Oaxaca'
  }
];
---

<BaseLayout 
  title="Mapa del Instituto Tecnológico de Oaxaca - XXXI Encuentro Nacional" 
  description="Mapa interactivo y ubicación de puntos clave en la sede del evento."
>
  <div class="page-header">
    <div class="container">
      <h1>Mapa de la Sede</h1>
      <p>Selecciona un punto de interés para verlo en el mapa</p>
    </div>
  </div>

  <section class="map-section">
    <div class="container layout-grid">
      
      <!-- Lista / Tabulador -->
      <div class="locations-sidebar">
        <h2>Puntos de Interés</h2>
        <div class="locations-list">
          {locations.map((loc, index) => (
            <div 
              class={`location-card ${index === 0 ? 'active' : ''}`} 
              data-id={loc.id} 
              data-mapa={loc.images.mapa}
              data-satelital={loc.images.satelital}
            >
              <div class="card-content" onclick="selectLocation(this)">
                <div class="card-header">
                  <Icon icon={loc.icon} class="location-icon" width="1.25rem" height="1.25rem" />
                  <h3>{loc.name}</h3>
                </div>
                <p>{loc.description}</p>
              </div>
              <div class="card-actions">
                <a href={loc.routeUrl} target="_blank" rel="noopener noreferrer" class="route-btn" title="Cómo llegar con Google Maps">
                  <Icon icon="mdi:map-marker" class="route-icon" width="1rem" height="1rem" />
                  Ver en Google Maps
                </a>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- Mapa (Imagen) -->
      <div class="map-container">
        <div class="map-controls">
          <button class="mode-btn active" data-mode="mapa" onclick="setMode('mapa')">
            <Icon icon="mdi:map" class="mode-icon" width="1.1rem" height="1.1rem" />
            Mapa
          </button>
          <button class="mode-btn" data-mode="satelital" onclick="setMode('satelital')">
            <Icon icon="mdi:satellite-variant" class="mode-icon" width="1.1rem" height="1.1rem" />
            Satelital
          </button>
        </div>
        <div class="image-wrapper">
            <img 
              id="main-map-image" 
              src={locations[0].images.mapa} 
              alt="Vista del mapa"
              class="map-image"
            />
        </div>
      </div>

    </div>
  </section>
</BaseLayout>

<style>
  .page-header {
    background: linear-gradient(135deg, #1B396A 0%, #152d52 100%);
    color: white;
    padding: 3rem 0;
    text-align: center;
  }

  .page-header h1 {
    font-size: 2.5rem;
    margin: 0 0 0.5rem 0;
    font-weight: 700;
    color: white;
  }

  .page-header p {
    font-size: 1.1rem;
    opacity: 0.9;
    color: white;
  }

  .map-section {
    padding: 3rem 0;
    background-color: #f4f6f9;
    min-height: 70vh;
  }

  .container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  .layout-grid {
    display: grid;
    grid-template-columns: 350px 1fr;
    gap: 2rem;
    align-items: start;
  }

  /* Sidebar */
  .locations-sidebar {
    background: white;
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    height: 600px;
    overflow-y: auto;
  }

  .locations-sidebar h2 {
    color: #1B396A;
    margin-top: 0;
    margin-bottom: 1rem;
    padding-bottom: 0.6rem;
    border-bottom: 2px solid #f0f0f0;
    font-size: 1.3rem;
  }

  .locations-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .location-card {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-left: 4px solid transparent; 
    border-radius: 8px;
    transition: all 0.2s ease;
    width: 100%;
    position: relative;
    display: flex;
    flex-direction: column;
  }

  .card-content {
    padding: 0.875rem;
    cursor: pointer;
    flex-grow: 1;
  }

  .card-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.35rem;
  }

  .location-icon {
    font-size: 1.25rem;
    color: #1B396A;
    flex-shrink: 0;
  }

  .location-card.active .location-icon {
    color: #C59B6D;
  }

  .location-card:hover {
    background: white;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  }

  .location-card.active {
    background: white;
    border-color: #e9ecef;
    border-left-color: #C59B6D;
    box-shadow: 0 4px 12px rgba(197, 155, 109, 0.15);
  }

  .location-card h3 {
    margin: 0 0 0.35rem 0;
    color: #1B396A;
    font-size: 1rem;
  }

  .location-card p {
    margin: 0 0 0.35rem 0;
    font-size: 0.85rem;
    color: #666;
  }

  .indicator {
    display: flex;
    align-items: center;
    font-size: 0.8rem;
    font-weight: 600;
    color: #C59B6D;
    opacity: 0;
    height: 0;
    overflow: hidden;
    transition: all 0.3s ease;
    margin-top: 0;
  }

  .location-card.active .indicator {
    opacity: 1;
    height: auto;
    margin-top: 0.35rem;
  }

  .card-actions {
    border-top: 1px solid #eee;
    padding: 0.5rem 0.875rem;
    display: flex;
    justify-content: flex-end;
    background: #fafafa;
    border-bottom-left-radius: 8px;
    border-bottom-right-radius: 8px;
  }

  .route-btn {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.8rem;
    font-weight: 600;
    color: #1B396A;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .route-icon {
    font-size: 1rem;
  }

  .route-btn:hover {
    color: #C59B6D;
    text-decoration: underline;
  }

  /* Map Container */
  .map-container {
    height: 600px;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    position: sticky;
    top: 100px;
    display: flex;
    flex-direction: column;
  }

  .map-controls {
    padding: 1rem;
    background: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
    display: flex;
    gap: 1rem;
    justify-content: center;
  }

  .mode-btn {
    padding: 0.6rem 1.5rem;
    border: 1px solid #1B396A;
    background: white;
    color: #1B396A;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .mode-icon {
    font-size: 1.1rem;
  }

  .mode-btn.active, .mode-btn:hover {
    background: #1B396A;
    color: white;
  }

  .image-wrapper {
    flex-grow: 1;
    position: relative;
    overflow: hidden;
    background: #eee;
  }

  .map-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
  }

  /* Scrollbar personalizado */
  .locations-sidebar::-webkit-scrollbar {
    width: 8px;
  }
  .locations-sidebar::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }
  .locations-sidebar::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 4px;
  }
  .locations-sidebar::-webkit-scrollbar-thumb:hover {
    background: #aaa;
  }

  /* Responsive */
  @media (max-width: 900px) {
    .layout-grid {
      grid-template-columns: 1fr;
    }

    .locations-sidebar {
      height: auto;
      max-height: 400px;
    }

    .map-container {
      height: 500px;
      position: static;
    }
  }
</style>

<script is:inline>
  let currentMode = 'mapa'; // 'mapa' or 'satelital'
  let currentCard = null;

  function initMapInteractivity() {
    const cards = document.querySelectorAll('.location-card');
    const mapImage = document.getElementById('main-map-image');
    
    // Set initial active card
    currentCard = document.querySelector('.location-card.active');

    if (!mapImage) return;

    window.selectLocation = (element) => {
        const card = element.closest('.location-card');
        
        // Remove active from all
        cards.forEach(c => c.classList.remove('active'));
        
        // Activate current
        card.classList.add('active');
        currentCard = card;

        updateImage();
    };

    window.setMode = (mode) => {
        currentMode = mode;
        
        // Update buttons
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.mode === mode);
        });

        updateImage();
    }

    function updateImage() {
        if (!currentCard || !mapImage) return;
        
        const newSrc = currentCard.getAttribute(`data-${currentMode}`);
        if (newSrc) {
            mapImage.src = newSrc;
        }
    }
  }

  // Inicializar al cargar
  document.addEventListener('DOMContentLoaded', initMapInteractivity);
  // Soporte para transiciones de Astro (View Transitions)
  document.addEventListener('astro:page-load', initMapInteractivity);
</script>
